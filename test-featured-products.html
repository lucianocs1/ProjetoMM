<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Produtos em Destaque</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product { border: 1px solid #ccc; margin: 10px; padding: 10px; }
        .featured { background-color: #fffacd; }
        button { margin: 5px; padding: 5px 10px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Teste de Produtos em Destaque</h1>
    
    <div>
        <button onclick="loadAllProducts()">Carregar Todos os Produtos</button>
        <button onclick="loadFeaturedProducts()">Carregar Produtos em Destaque</button>
    </div>
    
    <div id="message"></div>
    
    <div id="products"></div>
    
    <script>
        const API_BASE = 'http://localhost:5006/api';
        
        async function loadAllProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const products = await response.json();
                displayProducts(products, 'Todos os Produtos');
                showMessage('Produtos carregados com sucesso!', 'success');
            } catch (error) {
                showMessage('Erro ao carregar produtos: ' + error.message, 'error');
            }
        }
        
        async function loadFeaturedProducts() {
            try {
                const response = await fetch(`${API_BASE}/products?featured=true`);
                const products = await response.json();
                displayProducts(products, 'Produtos em Destaque');
                showMessage('Produtos em destaque carregados com sucesso!', 'success');
            } catch (error) {
                showMessage('Erro ao carregar produtos em destaque: ' + error.message, 'error');
            }
        }
        
        async function toggleFeatured(productId, currentStatus) {
            try {
                const response = await fetch(`${API_BASE}/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        isFeatured: !currentStatus
                    })
                });
                
                if (response.ok) {
                    showMessage(`Produto ${!currentStatus ? 'marcado como' : 'removido dos'} destaque!`, 'success');
                    loadAllProducts(); // Recarregar lista
                } else {
                    showMessage('Erro ao atualizar produto', 'error');
                }
            } catch (error) {
                showMessage('Erro ao atualizar produto: ' + error.message, 'error');
            }
        }
        
        function displayProducts(products, title) {
            const container = document.getElementById('products');
            let html = `<h2>${title} (${products.length} produtos)</h2>`;
            
            products.forEach(product => {
                html += `
                    <div class="product ${product.isFeatured ? 'featured' : ''}">
                        <h3>${product.name}</h3>
                        <p>Preço: R$ ${product.price}</p>
                        <p>Categoria: ${product.categoryName || 'N/A'}</p>
                        <p>Em destaque: ${product.isFeatured ? 'Sim' : 'Não'}</p>
                        <button onclick="toggleFeatured(${product.id}, ${product.isFeatured})">
                            ${product.isFeatured ? 'Remover destaque' : 'Marcar como destaque'}
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<p class="${type}">${message}</p>`;
            setTimeout(() => messageDiv.innerHTML = '', 5000);
        }
        
        // Carregar produtos automaticamente
        loadAllProducts();
    </script>
</body>
</html>
